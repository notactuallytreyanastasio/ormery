{ "version": 3, "file": "java/ormery/src/main/java/ormery/sql/SqlBuilder.java", "sources": [ "-work/src/sql/builder.temper.md" ], "sourcesContent": [ "# SQL Query Builder\n\n## The `sql` tag\n\nThis builds a semi-structured *SqlFragment* representation that then can have\nvalues rendered for various DB dialects.\n\nTODO Would it be possible to extract a \u0022prepared statement\u0022 form as well? Could\nthat be recognized and cached instead of rebuilt each time?\n\n    export let sql = SqlBuilder;\n\n    export class SqlBuilder {\n      private let buffer: ListBuilder\u003cSqlPart\u003e = new ListBuilder();\n\n### appendSafe\n\n      public appendSafe(sqlSource: String): Void {\n        buffer.add(new SqlSource(sqlSource));\n      }\n\n### appendSqlFragment\n\nAdd the contents of another SQL fragment to this one.\n\n      @overload(\u0022append\u0022)\n      public appendFragment(fragment: SqlFragment): Void {\n        buffer.addAll(fragment.parts);\n      }\n\n### appendSqlPart\n\nAdd a single already qualified SQL part to this builder.\n\n      @overload(\u0022append\u0022)\n      public appendPart(part: SqlPart): Void {\n        buffer.add(part);\n      }\n\n### appendSqlPartList\n\n      @overload(\u0022append\u0022)\n      public appendPartList(values: List\u003cSqlPart\u003e): Void {\n        appendList(values) { (x: SqlPart) =\u003e appendPart(x) };\n      }\n\n### appendBoolean\n\n      @overload(\u0022append\u0022)\n      public appendBoolean(value: Boolean): Void {\n        buffer.add(new SqlBoolean(value));\n      }\n\n### appendBooleanList\n\n      @overload(\u0022append\u0022)\n      public appendBooleanList(values: Listed\u003cBoolean\u003e): Void {\n        appendList(values) { (x: Boolean) =\u003e appendBoolean(x) };\n      }\n\n### appendDate\n\nThe Temper date type naturally formats to YYYY-MM-DD, which is the standard SQL\ndate format.\n\n      @overload(\u0022append\u0022)\n      public appendDate(value: Date): Void {\n        buffer.add(new SqlDate(value));\n      }\n\n### appendDateList\n\n      @overload(\u0022append\u0022)\n      public appendDateList(values: Listed\u003cDate\u003e): Void {\n        appendList(values) { (x: Date) =\u003e appendDate(x) };\n      }\n\n### appendFloat64\n\n      @overload(\u0022append\u0022)\n      public appendFloat64(value: Float64): Void {\n        buffer.add(new SqlFloat64(value));\n      }\n\n### appendFloat64List\n\n      @overload(\u0022append\u0022)\n      public appendFloat64List(values: Listed\u003cFloat64\u003e): Void {\n        appendList(values) { (x: Float64) =\u003e appendFloat64(x) };\n      }\n\n### appendInt32\n\n      @overload(\u0022append\u0022)\n      public appendInt32(value: Int32): Void {\n        buffer.add(new SqlInt32(value));\n      }\n\n### appendInt32List\n\n      @overload(\u0022append\u0022)\n      public appendInt32List(values: Listed\u003cInt32\u003e): Void {\n        appendList(values) { (x: Int32) =\u003e appendInt32(x) };\n      }\n\n### appendInt64\n\n      @overload(\u0022append\u0022)\n      public appendInt64(value: Int64): Void {\n        buffer.add(new SqlInt64(value));\n      }\n\n### appendInt64List\n\n      @overload(\u0022append\u0022)\n      public appendInt64List(values: Listed\u003cInt64\u003e): Void {\n        appendList(values) { (x: Int64) =\u003e appendInt64(x) };\n      }\n\n### appendString\n\n      @overload(\u0022append\u0022)\n      public appendString(value: String): Void {\n        buffer.add(new SqlString(value));\n      }\n\n### appendStringList\n\n      @overload(\u0022append\u0022)\n      public appendStringList(values: Listed\u003cString\u003e): Void {\n        appendList(values) { (x: String) =\u003e appendString(x) };\n      }\n\n### appendList\n\nThis is a helper to make other list append methods easier.\n\n      private appendList\u003cT\u003e(values: Listed\u003cT\u003e, appendValue: Appender\u003cT\u003e): Void {\n        for (var i = 0; i \u003c values.length; i++) {\n          if (i \u003e 0) {\n            appendSafe(\u0022, \u0022);\n          }\n          appendValue(values[i]);\n        }\n      }\n\n### accumulated\n\nTODO Instead make some kind of Statement type.\n\n      public get accumulated(): SqlFragment {\n        new SqlFragment(buffer.toList())\n      }\n    }\n\n## Helper types\n\n    @fun interface Appender\u003cT\u003e(value: T): Void;\n" ], "names": [ "SqlBuilder", "SqlPart", "buffer", "sqlSource", "SqlSource", "t#1163", "SqlFragment", "fragment", "t#1161", "part", "values", "fn", "x", "value", "SqlBoolean", "t#1154", "SqlDate", "t#1148", "SqlFloat64", "t#1142", "SqlInt32", "t#1136", "SqlInt64", "t#1130", "SqlString", "t#1124", "T", "appendValue", "t#1116", "t#1118", "i", "t#1113" ], "mappings": "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" }